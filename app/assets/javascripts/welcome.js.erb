$(document).ready(function(){

})

  var map, infoWindow;
  var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  var labelIndex = 0;
  var markers = [];
  var savedmarkers= [];
  var firstmarker= true;
  var topic= '<%=image_url('0.png')%>';
  function initMap() {
    infoWindow = new google.maps.InfoWindow;

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        infoWindow.setPosition(pos);
        infoWindow.setContent('Location found.');
        infoWindow.open(map);
        map.setCenter(pos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 4,
      center: {lat: -34.397, lng: 150.644},
    });
    /*var marker = new google.maps.Marker({
      position: uluru,
      map: map
    });*/

    // This event listener calls addMarker() when the map is clicked.
    google.maps.event.addListener(map, 'click', function(event) {
      $.getJSON('/targets/load_create_target', function(data) {
        console.log('data',data.form)
        $(".rectangle").html(data.form);
        $(".topic").click(function() {
          console.log('data', $(this).data('topicId'));
          $('#topic_id').val( $(this).data('topicId'));
        });
      });
      if (!firstmarker){
        markers[0].setMap(null);
        markers.pop();
      }
      firstmarker= false;
      addMarker(event.latLng, map,topic);
      //window.location.replace('http://localhost:3000/targets/new');
    });
  }

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
                          'Error: The Geolocation service failed.' :
                          'Error: Your browser doesn\'t support geolocation.');
    infoWindow.open(map);
  }

  // Adds a marker to the map.
  function addMarker(location, map, topic) {
    // Add the marker at the clicked location, and add the next-available label
    // from the array of alphabetical characters.
    //var image = '/assets/images/marker.png'
    function createImage(url){
        var image = {
          url: url,
          // This marker is 32 pixels wide by 32 pixels tall.
          size: new google.maps.Size(32, 32),
          // The origin for this image is 0,0.
          origin: new google.maps.Point(0,0),
          // The anchor for this image is the base of the flagpole at 0,32.
          anchor: new google.maps.Point(0, 32)
        };
        return image;
      }

    var marker = new google.maps.Marker({
      position: location,
      //label: labels[labelIndex++ % labels.length],
      //icon: setIcon($('#topic').val()),
      map: map,
      icon: topic,
      draggable:true
    });
    markers.push(marker);
    map.panTo(location);
  }

  function addCircles(radius,topic){
    markers[0].setMap(null);
    var center= markers.pop().getPosition();
    addMarker(center, map,topic);

    var cityCircle = new google.maps.Circle({
      strokeColor: '#FDBD39',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FFCB03',
      fillOpacity: 0.35,
      map: map,
      center: center,
      radius: radius
    });

  }

  // google.maps.event.addDomListener(window, 'load', initialize);
 /*function setIcon(icon) {
   var url = '<% image_url('marker.png') %>';
   return url+'.png' || 'default.png';
 }*/
